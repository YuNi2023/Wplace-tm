<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#111111"/>
  <title>Wplace ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç† & é€šçŸ¥</title>

  <!-- OneSignal SDK -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "14fafe99-072e-475e-a1fa-6a76d3c5c695",
        notifyButton: { enable: false }
      });
      // ç¾åœ¨ã®æ¨©é™ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
      const perm = await OneSignal.Notifications.permission;
      console.log("permission:", perm); // default|granted|denied
    });

    // ã‚¯ãƒªãƒƒã‚¯ã§é€šçŸ¥è¨±å¯ã‚’è¦æ±‚ï¼ˆiOSã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¿…é ˆãŒç¢ºå®Ÿï¼‰
    async function requestPushPermission() {
      try {
        const OneSignal = window.OneSignal;
        if (!OneSignal) return alert("OneSignalã®åˆæœŸåŒ–å¾…ã¡ã§ã™ã€‚æ•°ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚");
        // iOSã§ã‚‚æœ‰åŠ¹ãªå…¬å¼API
        const granted = await OneSignal.Notifications.requestPermission();
        alert(granted ? "é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼" : "é€šçŸ¥ã¯è¨±å¯ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚");
      } catch (e) {
        console.error(e);
        alert("é€šçŸ¥è¨±å¯ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
      }
    }
  </script>
</head>
<body>
  <h1>Wplace ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</h1>

  <!-- â† ã“ã‚Œã‚’ã‚¿ãƒƒãƒ—ã—ã¦è¨±å¯ã‚’å‡ºã™ -->
  <p><button onclick="requestPushPermission()">ğŸ”” é€šçŸ¥ã‚’æœ‰åŠ¹åŒ–</button></p>

  <form id="accountForm">
    <label>ãƒ¡ãƒ¼ãƒ«: <input required name="email" type="email"></label><br>
    <label>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå: <input required name="name" type="text"></label><br>
    <label>Level(ä¾‹: Level2 (14%)): <input name="level" type="text"></label><br>
    <label>Droplets: <input required name="droplets" type="number" min="0"></label><br>
    <label>Paintä¸Šé™(cap): <input required name="cap" type="number" min="1"></label><br>
    <label>ç¾åœ¨Paint(cur): <input required name="cur" type="number" min="0" step="1"></label><br><br>

    <fieldset>
      <legend>é€šçŸ¥è¨­å®šï¼ˆã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰</legend>
      <label><input type="checkbox" name="notif_full"> å…¨å›å¾©æ™‚</label><br>
      <label>å…¨å›å¾©â—‹åˆ†å‰: <input name="notif_full_minutes_before" type="number" min="1" placeholder="ä¾‹: 10"></label><br>
      <label>å…¨å›å¾©â—‹%å‰: <input name="notif_full_percent_before" type="number" min="1" max="99" placeholder="ä¾‹: 10"></label><br>
      <label>æŒ‡å®šPaintã«åˆ°é”: <input name="notif_target_paint" type="number" min="0" placeholder="ä¾‹: 1000"></label><br>
    </fieldset>
    <button type="submit">ç™»éŒ²/æ›´æ–°</button>
  </form>

  <hr>
  <h2>ç™»éŒ²æ¸ˆã¿ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h2>
  <ul id="list"></ul>

  <script src="app.js"></script>
</body>
</html>
